---
title: "VHDL Recursion and Useful Error Messages"
layout: page 
pager: true
author: philippe.faes (Sigasi)
date: 2011-01-16
tags: 
  - EDA2.0
  - VHDL
---
<div class="content">
<p>If hardware designers are to be more productive, the tools need to be better. Instead of building more complex tools (think: ESL and the likes) the EDA vendors should keep an appropriate focus on basic usability. Because, as Richard Goering says, <a href="http://www.cadence.com/Community/blogs/ii/archive/2010/05/24/what-is-eda-software-quality.aspx" class="elf-external elf-icon">just because it doesn't crash doesn't mean "quality."</a></p><p>I just <em>lost two hours struggling with VHDL simulators</em>, while in fact I wrote a silly error in my VHDL code. If I write a simple VHDL error, I expect a simple error message. Now, the error I made was a function call with infinite recursion. Granted, most VHDL designers avoid recursion all together, but that is beside the point. Recursion makes it easy to express an algorithm, and is is fully supported in the VHDL standard. There should be no reason to avoid it (at least not in behavioral code).</p><h2>Proper behavior</h2><p>Other languages provide decent error messages when you write infinite recursion:<br/><div class="geshifilter"><pre class="vhdl geshifilter-vhdl" style="font-family:monospace;">def foo<span style="color: #000000;">(</span>x<span style="color: #000000;">)</span><span style="color: #000066;">:</span>   <span style="color: #7f0055; font-weight: bold;">return</span> foo<span style="color: #000000;">(</span>x-<span style="color: #7d7d7d;">1</span><span style="color: #000000;">)</span>foo<span style="color: #000000;">(</span><span style="color: #7d7d7d;">5</span><span style="color: #000000;">)</span></pre></div><br/>Running this code in Python will get you a long stack trace that ends with:</p><p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;">File "test.py", line 2, in fooRuntimeError: maximum recursion depth exceeded</pre></div></p><p>After reading this, any 16 year old would think: "Hm, I might have hit the maximum recursion depth, perhaps there is something wrong with my recursive function foo in line 2." Problem fixed in 30 seconds or less.</p><p>Other languages use terms like "<a href="http://en.wikipedia.org/wiki/Stack_overflow" class="elf-external elf-icon">stack overflow</a>", which is a bit more abstract, but still easy to understand for any trained programmer or any kid with access to an online search engine.</p><h2>Confusing behavior</h2><p>I did a similar thing in VHDL. I wrote a textbook algorithm, the <a href="http://en.wikipedia.org/wiki/Factorial" class="elf-external elf-icon">factorial</a> function, using recursion. I wrote a small error which caused the function to recurse infinitely. Silly me.</p><p>The tools, however, were not helpful. Mentor Graphics Modelsim just froze. That gives me very little information. I didn't know whether there was a bug in Modelsim, if my system was set up incorrectly or if there was an error in my design. That's a lot of place to look for an error.</p><p>I couldn't help but try the same on Xilinx ISim. ISim did not freeze, but its error message was less than helpful:<br/><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;">ISim log fileRunning: /home/philippe.faes/workspace-sigasi/factorial/factorial -gui -tclbatch isim.cmd INFO: There is another simulation running in the same directory. Using database file name isim1.wdb.ISim M.70d (signature 0x61e1bd6e)WARNING: A WEBPACK license was found.WARNING: Please use Xilinx License Configuration Manager to check out a full ISim license.WARNING: ISim will run in Lite mode. Please refer to the ISim documentation for more information on the differences between the Lite and the Full version.This is a Lite version of ISim.Time resolution is 1 ps# wave add fac_tb# run allSimulator is doing circuit initialization process.Finished circuit initialization process.The simulator has terminated in an unexpected manner.  Please review the ISim log (isim.log) for details.</pre></div></p><p>So, let's look at isim.log, then. Oh no, that <em>was</em> isim.log! I expect you'd agree: there is ample room for improvement in the error messages.</p><h2><a name="action" id="action"/>Call to action</h2><p>But according to the <a href="http://www.jongordon.com/thenocomplainingrule.html" class="elf-external elf-icon">No Complaining Rule</a>, only constructive complaints are allowed. So, here is a way for you to help me solve this.</p><p>If you run in to cryptic error messages like this, please <em>report them to your tool vendor</em>. It is your right and your duty towards yourself and your fellow hardware designers. This is the only way the quality of your tools is going to increase. </p><h3>Disclaimer</h3><p> Sigasi is not without sin either. We work hard to make our software user friendly, and sometimes we fail. Please <a href="/forums/discussion-forum">let us know</a>!</p>  </div>

