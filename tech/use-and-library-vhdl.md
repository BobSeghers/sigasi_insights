---
title: '"Use" and "Library" in VHDL'
layout: page 
pager: true
author: philippe.faes (Sigasi)
date: 2013-09-09
tags: 
  - VHDL
  - use
  - library
---
<div class="content">
<p>Beginning <span class="caps">VHDL</span> engineers, and advanced engineers too, can get confused about the exact scope of a <em>use clause</em> and a <em>library clause</em> in <span class="caps">VHDL</span>. They usually show up at the top of a file, which would make you think that they are visible in the entire file. Unfortunately, the truth is a bit more complex. </p>	<p>First a small disclaimer: we've read the <span class="caps">VHDL</span> Language Reference Manual more thoroughly than 99.99% of  all engineers you are ever going to meet (and more than what will make even a die-hard language geek happy). Still, it is a heavy document and the language tends to be unambiguous only after you have understood what it means. We've tested our assumptions against some common industry standard simulators to confirm our findings. However, the <span class="caps">VHDL</span> language, the simulators and this article were all made by man. So you might still find an error somewhere. </p>	<h2>Use clause' scope is the file?</h2>	<p>That said: a first example shows a file with an entity and its architecture. The <span class="caps">VHDL</span> datatype <code>std_logic</code> is declared in <code>ieee.std_logic_1164</code>, and so a <em>use clause</em> at the top of the file makes the datatype visible for later reuse. Above the <em>use clause</em>, we need a <em>library</em> clause so that the compile would know that the word <code>ieee</code> is a library name. It would be reasonable, but incorrect, to assume that the <em>scope</em> (the range of places where its effects can be seen) of the use clause is the entire file.</p>	<p><span class="inline inline-center"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/f1.img_assist_custom-600x246.png" alt="Scope of use clause is not the entire file" title="Scope of use clause is not the entire file" class="image image-img_assist_custom-600x246 " width="600" height="245"/><span class="caption"><strong>Scope of use clause is not the entire file</strong></span></span></p>	<h2>First counterexample: the use clause spans multiple files?</h2>	<p>As a first counterexample, we show another oft-used construct: an entity and its architecture in two separate files. Here, it seems that the architecture seems to "inherit" the use clauses from its entity! In fact, the VHDL standard says that a "secondary unit" gets the same context as the corresponding "primary unit". So: architectures inherit the use clauses and library clauses from their entities, and a <em>package body</em> inherits from its <em>package</em> declaration.</p>	<p><span class="inline inline-center"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/f2.img_assist_custom-601x124.png" alt="Entity and architecture in two files" title="Entity and architecture in two files" class="image image-img_assist_custom-601x124 " width="601" height="124"/><span class="caption"><strong>Entity and architecture in two files</strong></span></span></p>	<h2>Second counterexample: the use clause does not span the entire file?</h2>	<p>The second counterexamples confirms that an architecture inherits use clauses from their architectures. The architectures that correspond to the entity at the top of the file inherit the context. The final design unit (entity <code>f3_</code>) does not know about the use clauses, and so you see an error here.</p>	<p><span class="inline inline-center"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/f3.img_assist_custom-601x335.png" alt="Architecture inherits context from Entity" title="Architecture inherits context from Entity" class="image image-img_assist_custom-601x335 " width="601" height="335"/><span class="caption"><strong>Architecture inherits context from Entity</strong></span></span></p>	<h2>Special exception</h2>	<p>So we know that the <em>VHDL secondary unit</em> (architecture or package body) inherits the context from the primary unit (entity), but we need to make an important nuance. An architecture's <em>context clause</em> is the part before the word "architecture" that can contains library clauses or use clauses. This context clause is not part of the architecture itself, and so it does not inherit the context of the entity.</p>	<p>This may seem confusing, and it is. </p>	<p>The historical reason for such strange behavior is that the VHDL and ADA languages were designed for ancient "one-pass" compilers. These compilers processed a file in a single pass, without looking forward and without going back. When the compiler processes a context clause, it does not yet know to which architecture this context clause will belong to. So it does not yet know which entity's context it should load. </p>	<p><span class="inline inline-center"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/f4.img_assist_custom-600x234.png" alt="Inherited use clause is not visible in context clause" title="Inherited use clause is not visible in context clause" class="image image-img_assist_custom-600x234 " width="599" height="234"/><span class="caption"><strong>Inherited use clause is not visible in context clause</strong></span></span></p>	<h2>Conclusion</h2>	<p>There is lots more to be said about scoping, especially inside a <em><span class="caps">VHDL</span> configuration</em>. But we'll save that story for another time. <br/>This article covered some cases that you are likely to encounter the first three examples in real life. Now that you know how scoping rules work for <span class="caps">VHDL</span> architectures and <span class="caps">VHDL</span> package bodies, you are less likely to get bitten by your compiler.</p>	<p>Admittedly, the last "special exception" does not have any major impact on your work as a hardware designer. But it is a cool piece of useless knowledge that you can use during job interviews or at the annual company barbecue.</p>  <div id="book-navigation-1518" class="book-navigation">            <div class="page-links clear-block">              <a href="/content/headers-and-templates" class="page-previous" title="Go to previous page">&#8249; Headers and templates</a>                    <a href="/content/vhdl-tips-tricks" class="page-up" title="Go to parent page">up</a>                    <a href="/content/vhdl-physical-type-not-synthesizable-or-it" class="page-next" title="Go to next page">VHDL Physical Type is not Synthesizable, or is it? &#8250;</a>          </div>      </div>  </div>

