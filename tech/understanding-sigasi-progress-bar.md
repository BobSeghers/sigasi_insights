---
title: "The magic of Sigasi's type-time compiler. Part 2: Builder"
layout: page 
pager: true
author: heeckhau (Sigasi)
date: 2011-12-23
tags: 
  - hdt-2.0
  - Xtext
---
<div class="content">
<p>In my <a href="http://www.sigasi.com/content/magic-sigasi-type-time-compiler">previous blog post</a>, I explained about the different Models (internal representations) that Sigasi builds to provide all the exciting Sigasi features. Today, I will explain the different phases of how these models are build. I also added screenshots of the progress view in the different phases. This should help you understand what is going on.</p>	<h2>Multiple pass builder</h2>	<p>Sigasi builds the Model by iterating over all your <span class="caps">VHDL</span> files in multiple passes. During the <strong>first pass</strong> Sigasi parses each <span class="caps">VHDL</span> file separately. From the parse results Sigasi constructs a <em>Meta Model</em>. And from this <em>Meta Model</em> Sigasi derives the information that needs to be added to the <em>Global Index</em>. During a <strong>second pass</strong> each file is analyzed in more detail. This results in syntactical and semantic problem markers in your files. In a <strong>third pass</strong> each file is iterated once more to extract even more information.</p>	<p><strong>Note:</strong> Sigasi uses the <a href="http://www.eclipse.org/articles/Article-Builders/builders.html" class="elf-external elf-icon">Eclipse builder mechanism</a> to build the model. Make sure it is enabled (<strong>Project &gt; Build Automatically</strong>), otherwise the Model will not be updated.</p>	<h3>First pass: Building the Global Index</h3>	<p>During the first pass Sigasi parses each file and constructs a <em>Meta Model</em>. This Model is queried for globally visible <span class="caps">VHDL</span> objects and these are added to the <em>Global Index</em>.</p>	<p><span class="inline inline-center"><a href="http://www.sigasi.com/sites/www.sigasi.com/files/images/phase1-global-index.png" onclick="launch_popup(1372, 861, 216); return false;" target="_blank"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/phase1-global-index.preview.png" alt="Phase 1 : Building the Global Index" title="Phase 1 : Building the Global Index" class="image image-preview " width="640" height="161"/></a><span class="caption"><strong>Phase 1 : Building the Global Index</strong></span></span></p>	<h3>Second pass: Validation</h3>	<p>During the second pass the <em>Meta Model</em> of each file is analyzed in full detail. This is the most computational expensive pass. <br/>This pass validates the <span class="caps">VHDL</span> syntax and creates problem markers for each problem it encounters. It also resolves all <em>cross links</em>, i.e. it checks that all references point to a valid declaration. During this validation the <em>Global Index</em> is used to figure out declarations in other files of your project. Often the builder has to load <em>Meta Models</em> of other files to find the exact declaration.</p>	<p>The second pass also runs all validation (linting) checks. For example, all port maps are checked for completeness, all case statements are checked, etc. </p>	<p><span class="inline inline-center"><a href="http://www.sigasi.com/sites/www.sigasi.com/files/images/phase2-validation.png" onclick="launch_popup(1373, 862, 215); return false;" target="_blank"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/phase2-validation.preview.png" alt="Phase 2 : Validation" title="Phase 2 : Validation" class="image image-preview " width="640" height="160"/></a><span class="caption"><strong>Phase 2 : Validation</strong></span></span></p>	<p><strong>Note:</strong> Open editors can be affected by a build. For example, an open editor could use a constant for of package that is not declared yet. So the editor will show an error marker. When the constant declaration is added in a second editor, the marker in the first editor needs to be updated. This will result in following message in the progress view:</p>	<p><span class="inline inline-center"><a href="http://www.sigasi.com/sites/www.sigasi.com/files/images/UpdatingEditorState.png" onclick="launch_popup(1374, 861, 216); return false;" target="_blank"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/UpdatingEditorState.preview.png" alt="Updating editor state" title="Updating editor state" class="image image-preview " width="640" height="161"/></a><span class="caption"><strong>Updating editor state</strong></span></span></p>	<h3>Third pass</h3>	<p>This phase runs a few so called builder participants, that extract more information from the Model for different purposes. Today there are two builder participants. The first builder participant counts the number of statements to switch between the <a href="http://www.sigasi.com/starterEditionOverLimit">Full and Baseline mode of the Starter Edition</a>. The second builder participant scans your <span class="caps">VHDL</span> comments for <a href="http://www.sigasi.com/image/todo-markers"><em><span class="caps">TODO</span></em> and <em><span class="caps">FIXME</span></em> markers</a>.</p>	<p><span class="inline inline-center"><a href="http://www.sigasi.com/sites/www.sigasi.com/files/images/Builder-Participants.png" onclick="launch_popup(1375, 862, 215); return false;" target="_blank"><img src="http://www.sigasi.com/sites/www.sigasi.com/files/images/Builder-Participants.preview.png" alt="Phase 3 : Builder participants" title="Phase 3 : Builder participants" class="image image-preview " width="640" height="160"/></a><span class="caption"><strong>Phase 3 : Builder participants</strong></span></span></p>	<h2>Conclusion</h2>	<p>Only the first time a project is opened, the builder needs to build the entire project. Next the <em>Global Index</em> and <em>Meta Models</em> are updated incrementally when files are modified. The Models are loaded as needed which keeps the memory footprint low.</p>	<p>Sigasi uses some very clever algorithms to build and query all <span class="caps">VHDL</span> information about your design. Sigasi is architected to be economical with memory, while being fast enough to give snappy feedback.</p>	<p>I hope this blog post shed some light on the magic behind Sigasi. You should now be able to understand what is going on, and what the progress messages exactly mean.</p>	<p>Hendrik</p>  </div>

