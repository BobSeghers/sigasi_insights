---
title: "Be careful with VHDL operator precedence"
layout: page 
pager: true
author: heeckhau (Sigasi)
date: 2014-12-02
tags: 
  - operators
  - VHDL
---
<div class="content">
<p>I was recently writing some tests for our VHDL expression evaluator and was amazed by the the result of evaluting <span class="geshifilter"><code class="vhdl geshifilter-vhdl">-<span style="color: #7d7d7d;">16</span> ** <span style="color: #7d7d7d;">2</span></code></span>.<br/>I expected <span class="geshifilter"><code class="vhdl geshifilter-vhdl"><span style="color: #7d7d7d;">256</span></code></span>, but it wasn't.</p><p>Can you guess the output of running this process?<br/><div class="geshifilter"><pre class="vhdl geshifilter-vhdl" style="font-family:monospace;">     <span style="color: #7f0055; font-weight: bold;">process</span> <span style="color: #7f0055; font-weight: bold;">is</span>     <span style="color: #7f0055; font-weight: bold;">begin</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"-5 mod (-3) : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">5</span> <span style="color: #7f0055; font-weight: bold;">mod</span> <span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">3</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"(-5) mod (-3) : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">5</span><span style="color: #000000;">)</span> <span style="color: #7f0055; font-weight: bold;">mod</span> <span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">3</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"-(5 mod (-3)) : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span>-<span style="color: #000000;">(</span><span style="color: #7d7d7d;">5</span> <span style="color: #7f0055; font-weight: bold;">mod</span> <span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">3</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"-16 ** 2 : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">16</span> ** <span style="color: #7d7d7d;">2</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"(-16) ** 2 : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">16</span><span style="color: #000000;">)</span> ** <span style="color: #7d7d7d;">2</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">report</span> <span style="color: #2a00ff;">"-(16 ** 2) : "</span> &amp; <span style="color: #808000;">integer</span><span style="color: #ff0000;">'image</span><span style="color: #000000;">(</span>-<span style="color: #000000;">(</span><span style="color: #7d7d7d;">16</span> ** <span style="color: #7d7d7d;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000066;">;</span>          <span style="color: #7f0055; font-weight: bold;">wait</span><span style="color: #000066;">;</span>     <span style="color: #7f0055; font-weight: bold;">end</span> <span style="color: #7f0055; font-weight: bold;">process</span> <span style="color: #000066;">;</span></pre></div></p><p>The output is:<br/><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;">     # ** Note: -5 mod (-3) : 1     # ** Note: (-5) mod (-3) : -2     # ** Note: -(5 mod (-3)) : 1     # ** Note: -16 ** 2 : -256     # ** Note: (-16) ** 2 : 256     # ** Note: -(16 ** 2) : -256 </pre></div></p><p>It turns out unary minus has a lower priority than the modulo and exponentiation operator. I had to consult the LRM again to find this list of operator priorities (from high to low):</p><ul><li> **, abs, not</li><li> *, /, mod, rem</li><li> +, - (unary versions)</li><li> +, -, &amp;</li><li> sll, srl, sla, sra, rol, ror</li><li> =, /=, &lt;, &lt;=, &gt;, &gt;=, ?=, ?/=, ?&lt;, ?&lt;=, ?&gt;, ?&gt;=</li><li> and, or, nand, nor, xor, xnor</li></ul><p>So be carefull when you are typing expressions; make sure you use enough parentheses.</p><p><em>P.S</em>: You may have noticed that I wrote <span class="geshifilter"><code class="vhdl geshifilter-vhdl">-<span style="color: #7d7d7d;">5</span> <span style="color: #7f0055; font-weight: bold;">mod</span> <span style="color: #000000;">(</span>-<span style="color: #7d7d7d;">3</span><span style="color: #000000;">)</span></code></span> and not <span class="geshifilter"><code class="vhdl geshifilter-vhdl">-<span style="color: #7d7d7d;">5</span> <span style="color: #7f0055; font-weight: bold;">mod</span> -<span style="color: #7d7d7d;">3</span></code></span>. The latter, <span class="geshifilter"><code class="vhdl geshifilter-vhdl">-<span style="color: #7d7d7d;">5</span> <span style="color: #7f0055; font-weight: bold;">mod</span> -<span style="color: #7d7d7d;">3</span></code></span>, is not valid VHDL. This again is because unary minus has lower priority than the modulo operator.</p>  <div id="book-navigation-1518" class="book-navigation">            <div class="page-links clear-block">              <a href="/content/scope-vhdl-use-clauses-and-vhdl-library-clauses" class="page-previous" title="Go to previous page">&#8249; The scope of VHDL use clauses and VHDL library clauses</a>                    <a href="/content/vhdl-tips-tricks" class="page-up" title="Go to parent page">up</a>                    <a href="/content/list-known-vhdl-metacomment-pragmas" class="page-next" title="Go to next page">List of known VHDL metacomment pragma's &#8250;</a>          </div>      </div>  </div>

